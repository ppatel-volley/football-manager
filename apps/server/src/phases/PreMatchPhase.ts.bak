import type { Phase } from "@volley/vgf/server"

import type { GameState } from "../shared/types/GameState"
import { PhaseName } from "../shared/types/PhaseName"

export const PreMatchPhase = {
    actions: {
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        startMatch: (ctx: any): GameState => 
{
            console.info("PreMatchPhase.startMatch - transitioning to kickoff")
            
            return {
                ...ctx.session.state as GameState,
                matchPhase: 'kickoff' as GameState['matchPhase']
            }
        }
    },
    
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    onBegin: (ctx: any): GameState => 
{
        console.info("PreMatchPhase.onBegin - Teams entering pitch")
        
        // Initialize pre-match state
        return {
            ...ctx.session.state as GameState,
            gameTime: 0,
            footballTime: "00:00",
            footballHalf: 1,
            matchPhase: 'pre_match' as GameState['matchPhase']
        }
    },
    
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    onEnd: (ctx: any): GameState => 
{
        console.info("PreMatchPhase.onEnd - Moving to kickoff")
        return ctx.session.state as GameState
    },
    
    // Auto-transition after 30 seconds (for demo purposes)
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    endIf: (ctx: any): boolean => 
{
        return ctx.session.state.gameTime >= 30 // 30 seconds
    },
    
    next: PhaseName.Kickoff,
} as const satisfies Phase<GameState>